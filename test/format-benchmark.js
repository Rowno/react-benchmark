const test = require('ava')
const formatBenchmark = require('../lib/format-benchmark')

test('formats a benchmark', (t) => {
  const fixture = {
    stats: {
      moe: 0.0000051306487763758425,
      rme: 3.1353553332052244,
      sem: 0.000002617677947130532,
      deviation: 0.000019413219231213135,
      mean: 0.00016363851082648617,
      sample: [
        0.00025766871165644174, 0.0002411764705882353, 0.00019154228855721393,
        0.0001837708830548926, 0.00019093078758949882, 0.00016666666666666666,
        0.00016414686825053996, 0.00016846652267818574, 0.00016149068322981365,
        0.00016356107660455487,
      ],
      variance: 3.768730809191435e-10,
    },
    times: {
      cycle: 0.08247380945654903,
      elapsed: 6.256,
      period: 0.00016363851082648617,
      timeStamp: 1517610881510,
    },
    hz: 6111.030923890211,
  }
  t.is(formatBenchmark(fixture), '10 runs sampled: 6,111 ops/sec ±3.14%')
})

test('handles a null hz', (t) => {
  const fixture = {
    stats: {
      moe: 0.0000051306487763758425,
      rme: 3.1353553332052244,
      sem: 0.000002617677947130532,
      deviation: 0.000019413219231213135,
      mean: 0.00016363851082648617,
      sample: [
        0.00025766871165644174, 0.0002411764705882353, 0.00019154228855721393,
        0.0001837708830548926, 0.00019093078758949882, 0.00016666666666666666,
        0.00016414686825053996, 0.00016846652267818574, 0.00016149068322981365,
        0.00016356107660455487,
      ],
      variance: 3.768730809191435e-10,
    },
    times: {
      cycle: 0.08247380945654903,
      elapsed: 6.256,
      period: 0.00016363851082648617,
      timeStamp: 1517610881510,
    },
    hz: null,
  }
  t.is(formatBenchmark(fixture), '10 runs sampled: 0 ops/sec ±3.14%')
})

test('formats RAM', (t) => {
  const cpuFixture = {
    stats: {
      moe: 0.0000051306487763758425,
      rme: 3.1353553332052244,
      sem: 0.000002617677947130532,
      deviation: 0.000019413219231213135,
      mean: 0.00016363851082648617,
      sample: [
        0.00025766871165644174, 0.0002411764705882353, 0.00019154228855721393,
        0.0001837708830548926, 0.00019093078758949882, 0.00016666666666666666,
        0.00016414686825053996, 0.00016846652267818574, 0.00016149068322981365,
        0.00016356107660455487,
      ],
      variance: 3.768730809191435e-10,
    },
    times: {
      cycle: 0.08247380945654903,
      elapsed: 6.256,
      period: 0.00016363851082648617,
      timeStamp: 1517610881510,
    },
    hz: 6111.030923890211,
  }
  const ramFixture = [
    1935840, 1935620, 1970808, 2184144, 2251400, 2176824, 2036096, 2001896,
    2014948, 2026948, 2032592, 2043912, 2054252, 2075380, 2087128, 2091700,
    2102852, 2114836, 2124460, 2127748, 2138404, 2141368, 2156220, 2158988,
    2161648, 2170340, 2173064, 2182652,
  ]
  const objectsCountFixture = [
    3473, 3482, 3483, 3494, 3495, 3656, 3497, 3509, 3521, 3533, 3545, 3557,
    3569, 3581, 3593, 3605, 3617, 3629, 3641, 3653, 3665, 3677, 3689, 3701,
    3713, 3725, 3737,
  ]
  t.is(
    formatBenchmark(cpuFixture, ramFixture, objectsCountFixture),
    '10 runs sampled: 6,111 ops/sec ±3.14% / RAM: 2 MB ±1.49% / Objects: 3594 ±0.93%'
  )
})
